---
name: "finishing-a-development-branch"
description: "Use when implementation is complete, all tests pass, and you need to decide how to integrate the work - guides completion of development work by presenting structured options for merge, PR, or cleanup"
---
# 开发分支收尾规范

## 功能概览

通过清晰选项引导开发工作的完成，遵循「验证测试→呈现选项→执行选择→清理环境」的核心原则。

**启动声明**：
 "正在使用「开发分支收尾」技能完成当前工作"

## 标准化流程

### 第一步：验证测试

执行项目测试套件（根据技术栈选择对应命令）：

```
pnpm test / cargo test / pytest / go test ./...
```

**测试失败处理**：

```
检测到<N>个测试失败，必须修复后才能合并：  

[显示失败详情]  
```

→ 终止流程，不进入下一步

**测试通过**：继续下一步

### 第二步：确认基准分支

自动检测分支来源：

```
git merge-base HEAD main 2>/dev/null || git merge-base HEAD master 2>/dev/null  
```

或确认："当前分支基于main分支创建，是否正确？"

### 第三步：呈现选项

**标准选项模板**（保持精简不解释）：

```
实现已完成，请选择操作：  

1. 本地合并到<基准分支>  

2. 推送并创建Pull Request  

3. 保留分支暂不处理  

4. 废弃本次工作  

请选择编号：
```

### ▨ 第四步：执行选择

**选项1：本地合并**

```
git checkout <基准分支>  

git pull  

git merge <特性分支>  

<测试命令>  # 合并后二次验证  

git branch -d <特性分支>  
```

**选项2：创建PR**

```
git push -u origin <特性分支>  

gh pr create --title "PR标题" --body "$(cat <<'EOF'  

## 变更摘要  

- 功能点1  

- 功能点2  


## 测试方案  

- [ ] 测试步骤1  

EOF  

)"  
```

**选项3：暂存分支**
 → 保留工作区不清理

**选项4：废弃工作**
 需用户输入确认命令：

```
即将永久删除：  

- 分支<名称>  

- 所有提交记录：<提交列表>  

- 工作区路径：<路径>  

请输入'discard'确认操作：  
```

确认后执行：

```
git checkout <基准分支>  

git branch -D <特性分支>  
```

### ▨ 第五步：工作区清理

仅对选项1/4执行：

```
git worktree list | grep $(git branch --show-current)  

git worktree remove <路径>  
```

## 速查对照表

| 选项        | 合并操作 | 推送操作 | 保留工作区 | 分支清理 |
| :---------- | :------- | :------- | :--------- | :------- |
| 1. 本地合并 | ✓        | -        | -          | ✓        |
| 2. 创建PR   | -        | ✓        | ✓          | -        |
| 3. 暂存分支 | -        | -        | ✓          | -        |
| 4. 废弃工作 | -        | -        | -          | ✓(强制)  |

## 常见问题规避

❌ **跳过测试验证**

- 风险：合并问题代码或PR失败
- 对策：始终先验证测试

❌ **开放式提问**

- 风险：导致操作歧义
- 对策：严格使用4选项模板

❌ **误清工作区**

- 风险：选项2/3误删未提交内容
- 对策：仅清理选项1/4的工作区

❌ **无确认删除**

- 风险：意外丢失工作成果
- 对策：必须要求'discard'确认输入

## 红线准则

⚠️ **绝对禁止**：

- 在测试失败时继续流程
- 未经验证直接合并
- 未确认强制删除
- 未经请求强制推送

✅ **必须遵守**：

- 选项前100%通过测试
- 严格使用4选项模板
- 删除操作二次确认
- 按需清理工作区

## 关联技能

▸ **调用场景**：

- 「子任务驱动开发」最终阶段
- 「计划执行」收尾阶段

▸ **配套技能**：

- 「Git工作区管理」协同清理